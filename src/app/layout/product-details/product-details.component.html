<app-header></app-header>
<meta name="keywords"*ngIf="product.keywords != undefined" [content]="product.keywords" />
<meta name="description" *ngIf="product.metaDescription != undefined"/>
<p-toast position="center"></p-toast>
<section class="breadcrumbs">
  <div class="container">
    <ol>
      <li class="breadcrumb-item"><a routerLink="/">صفحه اصلی</a></li>
      <li class="breadcrumb-item"><a (click)="goProduct(product.categoryID, 0)" class="nuxt-link-active">{{product.Category[0].title}}</a></li>
      <li class="breadcrumb-item"><a (click)="goProduct(product.categoryID, product.subCategoryID)" class="nuxt-link-active"> {{product.SubCategory[0].title}}</a></li>
      <li class="breadcrumb-item active">{{ product.title }}</li>
    </ol>
    <h2>مشاهده جزییات محصول {{ product.title }}</h2>
  </div>
</section>

<div class="container">
  <div class="row detail-box">
    <div class="col-xl-6 col-lg-6">
      <p-galleria
        [value]="images"
        [responsiveOptions]="responsiveOptions"
        [containerStyle]="{ 'max-width': '660px', 'margin-top': '2em' }"
        [numVisible]="5"
        dir="ltr"
        thumbnailsPosition="bottom"
        [autoPlay]="true"
        [transitionInterval]="2000"
        [circular]="true"
        [showItemNavigators]="true"
        [showItemNavigatorsOnHover]="true"
      >
        <ng-template
          pTemplate="item"
          *ngFor="let item of images; let i = index"
        >
          <div class="full-screen">
            <a (click)="showLightbox(i)"><i class="fas fa-expand"></i></a>
          </div>
          <img
            [src]="item.previewImageSrc"
            style="width: 100%; height: 350px"
          />
          <lib-ngx-image-zoom
                  [thumbImage]='item.thumbnailImageSrc'
                  [fullImage]='item.previewImageSrc'
                  [magnification]="1"
                  [enableScrollZoom] = "true"
                  [enableLens]= "true"
                  [lensWidth]="200"
                  [lensHeight] = "150"
                  zoomMode="hover">
                </lib-ngx-image-zoom>

        </ng-template>
        <ng-template pTemplate="thumbnail" let-item>
          <div class="p-grid p-nogutter p-justify-center">
            <img
              [src]="item.thumbnailImageSrc"
              style="width: 80px; height: 80px; display: block"
            />
          </div>
        </ng-template>
      </p-galleria>
    </div>
    <div class="col-xl-6 col-lg-6">
      <p-panel dir="rtl">
        <ng-template pTemplate="header">
          <span class="col-6 text-right">
            <b>پک جراحی</b>
          </span>
          <span class="col-6 text-left" *ngIf="product.discountStatus">
            {{ product.Discount[0].discountTitle }}
          </span>
        </ng-template>

        <div class="row justify-content-center" *ngIf="!isLogged">
          <div class="col-12 align-items-center">
            <p class="small">
              حتما باید ابتدا در سایت <a routerLink="/register">ثبت نام</a> کنید
              و به حساب کاربری خود <a routerLink="/register">وارد</a> شوید تا
              بتوانید سفارش خود را ثبت نمایید.
            </p>
          </div>
        </div>

        <div class="row justify-content-center">
          <div class="col-12 align-items-center">
            <h2 class="text-info" style="font-size: 24px;margin-top: 15px;">
              <span *ngIf="product.discountStatus === false">
                {{ product.price | number }}
              </span>
              <span
                *ngIf="product.discountStatus === true"
                style="text-decoration: line-through"
              >
                {{ product.price | number }}
              </span>
              <span *ngIf="product.discountStatus === true">
                &nbsp;
                {{
                  product.price -
                    (product.price * product.Discount[0].discountPercent) / 100
                    | number
                }}
              </span>

              تومان
            </h2>
          </div>
        </div>

        <form [formGroup]="form" (ngSubmit)="submitForm()" class="w-100 mt-3">
          <div class="form-group">
            <div class="p-field text-right">
              <p>تعداد سفارش</p>
              <p-inputNumber
                [(ngModel)]="count"
                [showButtons]="true"
                buttonLayout="horizontal"
                inputId="count"
                spinnerMode="horizontal"
                [step]="1"
                [min]="1"
                decrementButtonClass="p-button-info"
                incrementButtonClass="p-button-info"
                incrementButtonIcon="pi pi-plus"
                decrementButtonIcon="pi pi-minus"
                formControlName="count"
              >
              </p-inputNumber>
              <ul
                class="mt-1 text-right list-inline"
                *ngFor="let error of errorMessages.count"
              >
                <li
                  class="
                    font-small
                    text-danger
                    font-title-bold
                    list-inline-item
                  "
                  *ngIf="
                    form.get('count').hasError(error.type) &&
                    (form.get('count').dirty || form.get('count').touched)
                  "
                >
                  {{ error.message }}
                </li>
              </ul>
            </div>
          </div>
          <div class="form-group text-right">
            <p>توضیحات</p>
            <textarea
              class="form-control"
              name="description"
              id="description"
              formControlName="description"
              rows="5"
            ></textarea>
          </div>
          <div class="p-field-checkbox">
            <p-checkbox
              name="group1"
              value="true"
              (onChange)="hasDiscountCode = !hasDiscountCode"
              inputId="dc"
            ></p-checkbox>
            <label for="dc" class="mb-0 mr-3">آیا کد تخفیف دارید؟</label>
          </div>
          <div class="form-group text-right" *ngIf="hasDiscountCode">
            <p>کد تخفیف</p>
            <input
              type="text"
              pInputText
              formControlName="discountCode"
              class="form-control"
              id="discountCode"
            />
          </div>
          <div class="mb-3">
            <button
              type="submit"
              class="btn mx-auto d-block mt-2 text-white add-to-cart"
            >
              ثبت سفارش
            </button>
          </div>
        </form>
      </p-panel>
    </div>
  </div>

  <div class="row detail-box mb-5">
    <div class="col-12">
      <p-tabView class="tabview">
        <p-tabPanel header="ویژگی ها" leftIcon="pi pi-list">
          <table>
            <tbody>
              <tr *ngFor="let item of featuresValues">
                <td>{{ item.feature }}</td>
                <td>{{ item.value }}</td>
              </tr>
            </tbody>
          </table>
        </p-tabPanel>
        <p-tabPanel header="توضیحات" leftIcon="pi pi-book">
          <p>
            {{ product.detail }}
          </p>
        </p-tabPanel>
        <p-tabPanel header="راهنما" leftIcon="pi pi-question-circle">
          <p>
            {{ product.help }}
          </p>
        </p-tabPanel>
        <p-tabPanel header="دیدگاه" leftIcon="pi pi-comments">
          <div class="command-form">
            <form [formGroup]="formComment">
              <div class="form-group mt-3 justify-content-center">
                <label>نظر شما (اجباری)</label>
                <textarea
                  class="form-control"
                  name="commentText"
                  id="commentText"
                  formControlName="commentText"
                ></textarea>
                <ul
                  class="mt-1 text-right list-inline"
                  *ngFor="let error of commentErrorMessages.commentText"
                >
                  <li
                    class="
                      font-small
                      text-danger
                      font-title-bold
                      list-inline-item
                    "
                    *ngIf="
                      formComment.get('commentText').hasError(error.type) &&
                      (formComment.get('commentText').dirty ||
                        formComment.get('commentText').touched)
                    "
                  >
                    {{ error.message }}
                  </li>
                </ul>

                <button
                  type="submit"
                  class="btn mx-auto d-block mt-2 text-white add-to-cart"
                  (click)="registerComment()"
                  [disabled]="formComment.invalid"
                >
                  ثبت دیدگاه
                </button>
              </div>
            </form>
          </div>
          <div
            class="row justify-content-center comment"
            *ngIf="product.Comment.length > 0"
          >
            <div class="col-12 align-items-center text-center">
              <div class="title-box-d">
                <h3 class="title-d">دیدگاه ها ({{ commentsCount }})</h3>
              </div>
              <div class="box-comments">
                <ul class="list-comments" *ngFor="let item of product.Comment">
                  <li *ngIf="item.active">
                    <div class="comment-avatar">
                      <img [src]="item.User[0].image" alt="" />
                    </div>
                    <div class="comment-details">
                      <h4 class="comment-author">
                        {{ item.User[0].fullName }}
                      </h4>
                      <p class="comment-date"> {{ item.date }}</p>
                      <p class="comment-description">
                        {{ item.commentText }}
                      </p>
                    </div>
                  </li>
                  <li class="comment-children" *ngIf="item.reply != null">
                    <div class="comment-avatar">
                      <img
                        src="../../../assets/images/admin-default.png"
                        alt=""
                      />
                    </div>
                    <div class="comment-details">
                      <h4 class="comment-author">ادمین</h4>
                      <p class="comment-description">{{ item.reply }}</p>
                    </div>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </p-tabPanel>
      </p-tabView>
    </div>
  </div>
</div>

<app-footer></app-footer>
<ng-image-fullscreen-view
  [images]="images"
  [imageIndex]="currentIndex"
  [show]="showFlag"
  (close)="closeEventHandler()"></ng-image-fullscreen-view>
